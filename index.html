<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>SaintClick Software Online</title>

<link rel="icon" type="image/png" href="SaintClick.png">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg0:#020617;
  --card: rgba(15,23,42,0.88);
  --card2: rgba(2,6,23,0.62);
  --text:#e2e8f0;
  --muted:#9aa7bd;
  --cyan:#00f2ff;
  --border: rgba(255,255,255,0.08);
  --radius: 26px;
}

html,body{
  margin:0;
  padding:0;
  height:100%;
  overflow:hidden;
  background: var(--bg0);
}

body{
  font-family:'Orbitron',sans-serif;
  color:var(--text);
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}

.container{
  width: min(520px, 92vw);
  text-align:center;
  background: linear-gradient(180deg, var(--card), var(--card2));
  border-radius: var(--radius);
  padding: 38px 30px 28px;
  border: 1px solid var(--border);
  box-shadow:
    0 22px 60px rgba(0,0,0,0.55),
    0 0 70px rgba(0,242,255,0.10);
  opacity:0;
  transform: translateY(15px);
  transition: all 0.6s ease;
}

.container.loaded{
  opacity:1;
  transform: translateY(0);
}

.logo{
  width: 160px;
  margin-bottom: 16px;
}

.title{
  font-size: 24px;
  font-weight: 800;
  letter-spacing: 2px;
  color: var(--cyan);
}

.subtitle{
  font-size: 13px;
  color: var(--muted);
  margin-bottom: 14px;
}

.count{
  font-size: 64px;
  font-weight: 900;
  color: var(--cyan);
  margin: 6px 0 18px;
}

/* LISTA PERFECTA */
ul{
  list-style:none;
  padding:0;
  margin:0;

  display:flex;
  flex-direction:column;
  gap:8px;

  overflow-y:auto;
  scroll-snap-type: y mandatory;
  scroll-behavior:smooth;

  scrollbar-width:none;
  -ms-overflow-style:none;
}
ul::-webkit-scrollbar{
  width:0;
  height:0;
}

li{
  background: rgba(255,255,255,0.05);
  padding: 12px 14px;
  border-radius: 14px;
  font-size: 14px;
  cursor:pointer;
  border: 1px solid rgba(255,255,255,0.06);
  transition: 0.18s ease;
  scroll-snap-align:start;
}

li:hover{
  background: rgba(0,242,255,0.10);
  border-color: rgba(0,242,255,0.18);
}

/* OVERLAY */
.overlay{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(0,0,0,0.65);
  backdrop-filter: blur(14px);
  opacity:0;
  pointer-events:none;
  transition: opacity 0.25s ease;
}

.overlay.active{
  opacity:1;
  pointer-events:auto;
}

.modal{
  width:min(760px,94vw);
  background: linear-gradient(180deg, rgba(18,28,52,0.9), rgba(2,6,23,0.9));
  border-radius:22px;
  padding:24px;
  border:1px solid rgba(255,255,255,0.1);
  text-align:center;
  transform:scale(.9);
  transition:.25s ease;
}

.overlay.active .modal{
  transform:scale(1);
}

.overlay-pill{
  border-radius:16px;
  padding:14px 16px;
  background: rgba(15,23,42,0.9);
  border:1px solid rgba(255,255,255,0.1);
  font-family:'JetBrains Mono', monospace;
  font-size:16px;
  white-space:pre-wrap;
}

.mode-big{
  margin-top:14px;
  font-size:14px;
  color:var(--cyan);
  letter-spacing:2px;
  text-transform:uppercase;
}
</style>
</head>

<body>

<div class="container" id="mainContainer">
  <img src="SaintClick.png" class="logo">
  <div class="title">SaintClick Software</div>
  <div class="subtitle">Usuarios online</div>
  <div class="count" id="count">-</div>
  <ul id="userList"></ul>
</div>

<div class="overlay" id="overlay">
  <div class="modal">
    <div class="overlay-pill" id="overlayConfig"></div>
    <div class="mode-big" id="overlayMode"></div>
  </div>
</div>

<script>
const API_URL = "https://saintclick-api.onrender.com/online";
let lastOnline = null;

const overlay = document.getElementById("overlay");
const overlayConfig = document.getElementById("overlayConfig");
const overlayMode = document.getElementById("overlayMode");

overlay.addEventListener("click", e=>{
  if(e.target===overlay) overlay.classList.remove("active");
});

document.addEventListener("keydown", e=>{
  if(e.key==="Escape") overlay.classList.remove("active");
});

function limitarA3(){
  const list = document.getElementById("userList");
  const first = list.querySelector("li");
  if(!first) return;

  const gap = parseFloat(getComputedStyle(list).gap);
  const itemHeight = first.offsetHeight;
  const exact = (itemHeight * 3) + (gap * 2);

  list.style.maxHeight = exact+"px";
  list.style.overflowY = list.children.length>3?"auto":"hidden";
}

async function fetchOnlineUsers(initialLoad=false){
  const countEl = document.getElementById("count");
  const listEl = document.getElementById("userList");

  try{
    const response = await fetch(API_URL,{cache:"no-store"});
    if(!response.ok) throw new Error();

    const data = await response.json();
    const usuarios = Array.isArray(data.usuarios)?data.usuarios:[];
    const online = typeof data.online==="number"?data.online:usuarios.length;

    lastOnline = online;
    countEl.innerText = online;
    listEl.innerHTML="";

    usuarios.forEach(u=>{
      const li=document.createElement("li");
      li.textContent=(u.usuario||"").trim();

      li.addEventListener("click",()=>{
        if(!u.config) return;
        const parts=String(u.config).split("  |  ");
        overlayConfig.innerText=parts[1]||"(sin configuraciÃ³n)";
        overlayMode.innerText=parts[0]||"";
        overlay.classList.add("active");
      });

      listEl.appendChild(li);
    });

    requestAnimationFrame(limitarA3);

    if(initialLoad){
      document.getElementById("mainContainer").classList.add("loaded");
    }

  }catch{
    countEl.innerText = lastOnline ?? "-";
  }
}

/* 1 scroll = 1 usuario */
const list=document.getElementById("userList");
list.addEventListener("wheel",e=>{
  if(list.children.length<=3) return;
  e.preventDefault();

  const gap=parseFloat(getComputedStyle(list).gap);
  const first=list.querySelector("li");
  const step=first.offsetHeight+gap;

  list.scrollBy({
    top:e.deltaY>0?step:-step,
    behavior:"smooth"
  });
},{passive:false});

fetchOnlineUsers(true);
setInterval(()=>fetchOnlineUsers(false),10000);
</script>

</body>
</html>
